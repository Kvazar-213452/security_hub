<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Файловий сервер</title>
</head>
<body>
  <!-- Завантаження файлу -->
  <div class="padoge">
    <h2>Завантажити файл</h2>
    <div class="file-input-container">
      <input type="file" name="file" id="file" required>
      <label for="file" class="file-input-button">Виберіть файл</label>
    </div>
    <label for="password">Пароль для доступу до файлу:</label>
    <input type="text" name="password" id="password" required>
    <br><br>
    <button type="button" id="submit-btn">Завантажити</button>
  </div>
  <br>
  <!-- Пошук файлу -->
  <div class="padoge">
    <h2>Пошук файлу за паролем</h2>
    <label for="searchPassword">Пароль:</label>
    <input type="text" name="searchPassword" id="searchPassword" required>
    <br><br>
    <button type="button" id="search-btn">Знайти файл</button>
    <div id="searchResult"></div>
  </div>

  <!-- Скрипт -->
  <script>
    // Завантаження файлу
    document.getElementById('submit-btn').addEventListener('click', function() {
      const fileInput = document.getElementById('file');
      const password = document.getElementById('password').value;
      const file = fileInput.files[0];

      if (!file || !password) {
        alert('Будь ласка, виберіть файл і введіть пароль.');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);
      formData.append('password', password);

      fetch('http://localhost:3000/upload', {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(data => {
        alert('Файл успішно завантажено');
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Сталася помилка при завантаженні файлу');
      });
    });

    // Пошук файлу
    document.getElementById('search-btn').addEventListener('click', function () {
  const searchPassword = document.getElementById('searchPassword').value;

  fetch('http://localhost:3000/search', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ searchPassword }),
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.file && data.name) {
        // Конвертуємо base64 у Blob
        const binaryData = atob(data.file);
        const byteArray = new Uint8Array(binaryData.length);
        for (let i = 0; i < binaryData.length; i++) {
          byteArray[i] = binaryData.charCodeAt(i);
        }
        const blob = new Blob([byteArray]);

        // Створюємо посилання для завантаження
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = data.name;
        link.click();
      } else {
        document.getElementById('searchResult').innerText = 'Файл не знайдено.';
      }
    })
    .catch((error) => {
      console.error('Error:', error);
      document.getElementById('searchResult').innerText =
        'Сталася помилка при пошуку файлу.';
    });
});
  </script>
</body>
</html>
